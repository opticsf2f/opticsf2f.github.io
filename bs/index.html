<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='read' hidden></marimo-mode>
    <marimo-version data-version='0.10.19' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"theme": "light", "code_editor_font_size": 14, "cell_output": "above", "default_width": "medium", "dataframes": "rich"}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "on_cell_change": "autorun"}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "pip"}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "medium"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>marimo</title>
    <script type="module" crossorigin src="./assets/index-C_IDebto.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-DfLILvXO.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.10.19%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20T%20%3D%20mo.ui.slider(start%3D0.0%2C%20stop%3D1.0%2C%20step%3D0.1%2C%20label%3D%22Time%22%2C%20value%3D0)%0A%20%20%20%20T%0A%20%20%20%20return%20(T%2C)%0A%0A%0A%40app.cell%0Adef%20_(T%2C%20blochTest)%3A%0A%20%20%20%20blochTest(T.value)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20BlochSphere%2C%0A%20%20%20%20cDUggg%2C%0A%20%20%20%20cDUk%2C%0A%20%20%20%20cDUy%2C%0A%20%20%20%20getComplexColor%2C%0A%20%20%20%20np%2C%0A%20%20%20%20plt%2C%0A%20%20%20%20trajectory%2C%0A)%3A%0A%20%20%20%20def%20blochTest(time)%3A%0A%20%20%20%20%20%20%20%20fig%2C%20(ax1%2C%20ax2)%20%3D%20plt.subplots(1%2C2%2Cfigsize%3D(8%2C%204))%0A%20%20%20%20%20%20%20%20bs%20%3D%20BlochSphere()%0A%20%20%20%20%20%20%20%20dynamics%2C%20rho%20%3D%20trajectory()%0A%20%20%20%20%20%20%20%20bs.addStateBlob(*dynamics%5B0%2C%3A%5D)%0A%20%20%20%20%20%20%20%20bs.addTrajectory(dynamics)%0A%20%20%20%20%20%20%20%20pointInTime%20%3D%20int(((np.shape(dynamics)%5B0%5D-1)%20*%20time))%0A%20%20%20%20%20%20%20%20x%20%3D%20dynamics%5BpointInTime%2C0%5D%0A%20%20%20%20%20%20%20%20y%20%3D%20dynamics%5BpointInTime%2C1%5D%0A%20%20%20%20%20%20%20%20z%20%3D%20dynamics%5BpointInTime%2C2%5D%0A%20%20%20%20%20%20%20%20bs.addStateBlob(*dynamics%5BpointInTime%2C%3A%5D)%0A%20%20%20%20%20%20%20%20bs.addStateArrow(*dynamics%5BpointInTime%2C%3A%5D%2C)%0A%20%20%20%20%20%20%20%20bs.addStateArrow(0%2C1%2Fnp.sqrt(2)%2C1%2Fnp.sqrt(2)%2Ccolor%3DcDUy)%0A%20%20%20%20%20%20%20%20bs.plot(axis%3Dax1%2C%20labelAxis%3DFalse%2C%20labelSize%3D24%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%5Br'%24%5Cvert%20%7B%5Crm%200%7D%5Crangle%24'%2Cr'%24%5Cvert%20%7B%5Crm%201%7D%5Crangle%24'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2C%20%20%20%20%20%20%20%20%20%20%20%20labelOffset%20%3D%20%5B(1250%2C%200)%2C(350%2C%201600)%5D)%20%20%0A%20%20%20%20%20%20%20%20mdim%3D2%0A%20%20%20%20%20%20%20%20dim%3Dmdim%2B2%0A%0A%20%20%20%20%20%20%20%20R%3D0.85*np.ones((dim%2Cdim))%0A%20%20%20%20%20%20%20%20G%3D0.85*np.ones((dim%2Cdim))%0A%20%20%20%20%20%20%20%20B%3D0.85*np.ones((dim%2Cdim))%0A%20%20%20%20%20%20%20%20peak%20%3D%20np.amax(abs(rho))%0A%0A%20%20%20%20%20%20%20%20dots%20%3D%20%7B%22x%22%3A%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22y%22%3A%5B%5D%7D%0A%20%20%20%20%20%20%20%20dotsPath%20%3D%20%7B%22x%22%3A%5B%5D%2C%22y%22%3A%5B%5D%7D%0A%20%20%20%20%20%20%20%20referenceDots%20%3D%20%7B%22x%22%3A%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22y%22%3A%5B%5D%7D%0A%0A%20%20%20%20%20%20%20%20for%20col%20in%20range%20(0%2Cmdim)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20row%20in%20range%20(0%2Cmdim)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20R%5B1%2Brow%2C1%2Bcol%5D%3DgetComplexColor(rho%5Bcol%2B2*row%2CpointInTime%5D%2Cpeak)%5B0%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20G%5B1%2Brow%2C1%2Bcol%5D%3DgetComplexColor(rho%5Bcol%2B2*row%2CpointInTime%5D%2Cpeak)%5B1%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20B%5B1%2Brow%2C1%2Bcol%5D%3DgetComplexColor(rho%5Bcol%2B2*row%2CpointInTime%5D%2Cpeak)%5B2%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dots%5B%22x%22%5D.append(1%20%2B%20row%20%2B%20rho%5Bcol%2B2*row%2CpointInTime%5D.real*0.44)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dots%5B%22y%22%5D.append(1%20%2B%20col%20%2B%20rho%5Bcol%2B2*row%2CpointInTime%5D.imag*0.44)%0A%20%20%20%20%20%20%20%20RGB%3Dnp.dstack((R%2C%20G%2C%20B))%0A%20%20%20%20%20%20%20%20ax2.imshow(RGB)%0A%20%20%20%20%20%20%20%20ax2.text(-0.4%2C0%2Cr'%24%5Crho_%7Bmn%7D%24'%2Cfontsize%3D24)%0A%20%20%20%20%20%20%20%20ax2.text(-0.1%2C1.2%2Cr'%240%24'%2Cfontsize%3D24)%0A%20%20%20%20%20%20%20%20ax2.text(-0.1%2C2.2%2Cr'%241%24'%2Cfontsize%3D24)%0A%20%20%20%20%20%20%20%20ax2.text(1-0.1%2C0.2%2Cr'%240%24'%2Cfontsize%3D24)%0A%20%20%20%20%20%20%20%20ax2.text(2-0.1%2C0.2%2Cr'%241%24'%2Cfontsize%3D24)%0A%20%20%20%20%20%20%20%20ax2.set_axis_off()%20%0A%0A%20%20%20%20%20%20%20%20for%20col%20in%20range%20(0%2Cmdim)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20row%20in%20range%20(0%2Cmdim)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%20%3D%201%20%2B%20row%20%2B%20np.real(rho%5Bcol%2B2*row%2CpointInTime%5D)*0.44%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%20%3D%201%20%2B%20col%20%2B%20np.imag(rho%5Bcol%2B2*row%2CpointInTime%5D)*0.44%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ax2.scatter(1%2Brow%2C1%2Bcol%2C%20c%3DcDUggg%2C%20s%3D40)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ax2.scatter(x%2C%20y%2C%20c%3DcDUk%2C%20s%3D40)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ax2.arrow(1%2Brow%2C1%2Bcol%2C%20np.real(rho%5Bcol%2B2*row%2CpointInTime%5D)*0.44%2C%20np.imag(rho%5Bcol%2B2*row%2CpointInTime%5D)*0.44%2C%20linewidth%3D2%2C%20head_length%3D0%2C%20color%20%3D%20cDUk)%0A%0A%20%20%20%20%20%20%20%20return%20fig%2C%0A%20%20%20%20return%20(blochTest%2C)%0A%0A%0A%40app.cell%0Adef%20_(eig%2C%20kron%2C%20np)%3A%0A%20%20%20%20def%20trajectory()%3A%0A%20%20%20%20%20%20%20%20G%20%3D%200.0%0A%20%20%20%20%20%20%20%20Omega%3D%2010.0%0A%20%20%20%20%20%20%20%20Delta%3D%2010.0%0A%20%20%20%20%20%20%20%20phiL%3D%201*np.pi%2F2%20%23input%20parameter%0A%20%20%20%20%20%20%20%20H%3Dnp.array(%5B%5BDelta%2F2%2C%20(Omega%2F2)*np.exp(-1.j*phiL)%5D%2C%5B(Omega%2F2)*np.exp(1.j*phiL)%2C%20-Delta%2F2%5D%20%5D)%0A%20%20%20%20%20%20%20%20I2%3Dnp.eye(2%2C2)%0A%20%20%20%20%20%20%20%20Hrho%3Dkron(H%2CI2)%0A%20%20%20%20%20%20%20%20rhoH%3Dkron(I2%2Cnp.conj(H))%0A%20%20%20%20%20%20%20%20L%3Dnp.array(%5B%5B0%2C0%2C0%2CG%5D%2C%5B0%2C-G%2F2%2C0%2C0%5D%2C%5B0%2C0%2C-G%2F2%2C0%5D%2C%5B0%2C0%2C0%2C-G%5D%20%5D)%0A%20%20%20%20%20%20%20%20evals%2C%20evecs%20%3D%20eig(-1.j*(Hrho-rhoH)%2BL)%0A%20%20%20%20%20%20%20%20evecs%3Dnp.asmatrix(evecs)%0A%20%20%20%20%20%20%20%20rho0%3D0.0*np.ones((4%2C1))%0A%20%20%20%20%20%20%20%20rho0%5B0%5D%20%3D%201.0%0A%20%20%20%20%20%20%20%20npts%3D50%0A%20%20%20%20%20%20%20%20tmax%3D2*np.pi%2Fnp.sqrt(Omega**2%2BDelta**2)%0A%20%20%20%20%20%20%20%20t%3Dnp.linspace(0%2Ctmax%2Cnpts)%0A%20%20%20%20%20%20%20%20u%3Dnp.zeros(npts)%0A%20%20%20%20%20%20%20%20v%3Dnp.zeros(npts)%0A%20%20%20%20%20%20%20%20w%3Dnp.zeros(npts)%0A%20%20%20%20%20%20%20%20rho%20%3D%20(1.0%20%2B%201.j)*np.zeros((4%2Cnpts))%0A%20%20%20%20%20%20%20%20for%20i%20in%20range(0%2Cnpts)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20rho_vec%3Devecs*np.asmatrix(np.diag(np.exp(evals*t%5Bi%5D)))*np.linalg.inv(evecs)*rho0%0A%20%20%20%20%20%20%20%20%20%20%20%20rho%5B%3A%2Ci%5D%20%3D%20np.squeeze(np.asarray(rho_vec))%0A%20%20%20%20%20%20%20%20%20%20%20%20u%5Bi%5D%3D(rho%5B1%2Ci%5D%2Brho%5B2%2Ci%5D).real%0A%20%20%20%20%20%20%20%20%20%20%20%20v%5Bi%5D%3D(1.j*(rho%5B1%2Ci%5D-rho%5B2%2Ci%5D)).real%0A%20%20%20%20%20%20%20%20%20%20%20%20w%5Bi%5D%3D(rho%5B0%2Ci%5D-rho%5B3%2Ci%5D).real%0A%20%20%20%20%20%20%20%20return%20np.column_stack((u%2C%20v%2C%20w))%2C%20rho%0A%20%20%20%20return%20(trajectory%2C)%0A%0A%0A%40app.cell%0Adef%20_(%0A%20%20%20%20BytesIO%2C%0A%20%20%20%20Image%2C%0A%20%20%20%20cDUbbbb%2C%0A%20%20%20%20cDUk%2C%0A%20%20%20%20cDUkk%2C%0A%20%20%20%20cDUrr%2C%0A%20%20%20%20cDUsky%2C%0A%20%20%20%20latex2png%2C%0A%20%20%20%20np%2C%0A%20%20%20%20pv%2C%0A)%3A%0A%20%20%20%20class%20BlochSphere%3A%0A%20%20%20%20%20%20%20%20def%20__init__(self%2C%20r%3D3%2C%20resolution%3D3)%3A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p%20%3D%20pv.Plotter(shape%3D(1%2C%201)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20window_size%3D(resolution%20*%20100%2C%20resolution%20*%20100)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20off_screen%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20notebook%3DFalse)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.set_background(cDUsky%2C%20top%3D%22white%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.resolution%20%3D%20resolution%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20draw%20cross%20section%20of%20sphere%20with%20three%20principal%20coordinate%20planes%0A%20%20%20%20%20%20%20%20%20%20%20%20num%20%3D%2050%0A%20%20%20%20%20%20%20%20%20%20%20%20theta%20%3D%20np.linspace(-1%20*%20np.pi%2C%201%20*%20np.pi%2C%20num)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.r%20%3D%20r%0A%20%20%20%20%20%20%20%20%20%20%20%20phi%20%3D%200%20*%20np.pi%20%2F%2060%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20z%20%3D%200%20*%20self.r%20*%20np.cos(theta)%0A%20%20%20%20%20%20%20%20%20%20%20%20x%20%3D%20self.r%20*%20np.cos(theta)%0A%20%20%20%20%20%20%20%20%20%20%20%20y%20%3D%20self.r%20*%20np.sin(theta)%0A%20%20%20%20%20%20%20%20%20%20%20%20rpts%20%3D%20np.column_stack((x%2C%20y%2C%20z))%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%20%3D%20pv.Spline(rpts%2C%201000)%0A%20%20%20%20%20%20%20%20%20%20%20%20rxy_tube%20%3D%20spline.tube(radius%3D0.05)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20z%20%3D%20self.r%20*%20np.cos(theta)%0A%20%20%20%20%20%20%20%20%20%20%20%20x%20%3D%20self.r%20*%20np.sin(theta)%20*%20np.cos(phi%20-%20np.pi%20%2F%202)%0A%20%20%20%20%20%20%20%20%20%20%20%20y%20%3D%20self.r%20*%20np.sin(theta)%20*%20np.sin(phi%20-%20np.pi%20%2F%202)%0A%20%20%20%20%20%20%20%20%20%20%20%20rpts%20%3D%20np.column_stack((x%2C%20y%2C%20z))%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%20%3D%20pv.Spline(rpts%2C%201000)%0A%20%20%20%20%20%20%20%20%20%20%20%20rxz_tube%20%3D%20spline.tube(radius%3D0.05)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20z%20%3D%20self.r%20*%20np.cos(theta)%0A%20%20%20%20%20%20%20%20%20%20%20%20x%20%3D%20self.r%20*%20np.sin(theta)%20*%20np.cos(phi)%0A%20%20%20%20%20%20%20%20%20%20%20%20y%20%3D%20self.r%20*%20np.sin(theta)%20*%20np.sin(phi)%0A%20%20%20%20%20%20%20%20%20%20%20%20rpts%20%3D%20np.column_stack((x%2C%20y%2C%20z))%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%20%3D%20pv.Spline(rpts%2C%201000)%0A%20%20%20%20%20%20%20%20%20%20%20%20ryz_tube%20%3D%20spline.tube(radius%3D0.05)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%23%20add%20sphere%0A%20%20%20%20%20%20%20%20%20%20%20%20big%20%3D%20pv.Sphere(center%3D(0%2C%200%2C%200)%2C%20radius%3Dself.r)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(big%2C%20opacity%3D0.4%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22w%22%2C%20specular%3D0.85%2C%20smooth_shading%3DTrue)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20add%20cross-sections%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(rxy_tube%2C%20opacity%3D0.1%2C%20smooth_shading%3DTrue%2C%20color%3DcDUkk)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(rxz_tube%2C%20opacity%3D0.1%2C%20smooth_shading%3DTrue%2C%20color%3DcDUkk)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(ryz_tube%2C%20opacity%3D0.1%2C%20smooth_shading%3DTrue%2C%20color%3DcDUkk)%0A%0A%20%20%20%20%20%20%20%20def%20state2XYZ(complexVectorState)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20TO-Do%0A%20%20%20%20%20%20%20%20%20%20%20%20%23x%20%3D%0A%20%20%20%20%20%20%20%20%20%20%20%20%23y%20%3D%0A%20%20%20%20%20%20%20%20%20%20%20%20%23z%20%3D%0A%20%20%20%20%20%20%20%20%20%20%20%20%23return%20x%2Cy%2Cz%0A%20%20%20%20%20%20%20%20%20%20%20%20pass%0A%0A%20%20%20%20%20%20%20%20def%20addStateBlob(self%2C%20x%2Cy%2Cz%2C%20color%3DcDUrr%2C%20radius%3D0.2)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Adds%20highlighted%20Blob%20on%20or%20inside%20the%20Bloch%20sphere.%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20small%20%3D%20pv.Sphere(center%3Dnp.array(%5Bx%2C%20y%2C%20z%5D)*self.r%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20radius%3Dself.r%20%2F%203%20*%20radius)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(small%2C%20opacity%3D1.0%2C%20color%3Dcolor%2C%20smooth_shading%3DTrue)%0A%20%20%20%20%20%20%20%20%20%20%20%20pass%0A%0A%20%20%20%20%20%20%20%20def%20addStateArrow(self%2C%20x%2Cy%2Cz%2C%20color%3DcDUbbbb)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Adds%20state%20arrow%20to%20the%20Bloch%20sphere%2C%20given%20the%20tip%20position.%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20length%20%3D%20np.sqrt(x*x%20%2B%20y*y%20%2B%20z*z)%0A%20%20%20%20%20%20%20%20%20%20%20%20arrow%3Dpv.Arrow(start%3D(0.0%2C%200.0%2C%200.0)%2C%20direction%3Dnp.array(%5Bx%2Cy%2Cz%5D)%20*%20self.r%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tip_length%3D0.25%2C%20tip_radius%3D0.1%2C%20tip_resolution%3D20%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shaft_radius%3D0.05%2C%20shaft_resolution%3D20%2C%20scale%3Dlength%20*%20self.r)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(arrow%2C%20opacity%3D1.0%2C%20color%3Dcolor%2C%20smooth_shading%3DTrue)%0A%0A%20%20%20%20%20%20%20%20def%20addAxisArrow(self%2C%20x%2Cy%2Cz%2C%20color%3DcDUbbbb)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Adds%20state%20arrow%20to%20the%20Bloch%20sphere%2C%20given%20the%20tip%20position.%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20length%20%3D%20np.sqrt(x*x%20%2B%20y*y%20%2B%20z*z)%0A%20%20%20%20%20%20%20%20%20%20%20%20arrow%3Dpv.Arrow(start%3D(0.0%2C%200.0%2C%200.0)%2C%20direction%3Dnp.array(%5Bx%2Cy%2Cz%5D)%20*%20self.r%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tip_length%3D0.05%2Flength%2C%20tip_radius%3D0.02%2Flength%2C%20tip_resolution%3D20%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20shaft_radius%3D0.01%2Flength%2C%20shaft_resolution%3D20%2C%20scale%3Dlength%20*%20self.r)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(arrow%2C%20opacity%3D1.0%2C%20color%3Dcolor%2C%20smooth_shading%3DTrue)%0A%0A%20%20%20%20%20%20%20%20def%20addTrajectory(self%2C%20trajectoryXYZ)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Adds%20trajectory%20in%20time%2C%20with%20time%20shown%20with%20viridis%20colouring.%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%20%3D%20pv.Spline(trajectoryXYZ%20*%20self.r%2C%201000)%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%5B%22scalars%22%5D%20%3D%20np.arange(spline.n_points)%0A%20%20%20%20%20%20%20%20%20%20%20%20tubes%3Dspline.tube(radius%3D0.1)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(tubes%2C%20smooth_shading%3DTrue%2C%20show_scalar_bar%3DFalse)%0A%0A%20%20%20%20%20%20%20%20def%20addLine(self%2C%20trajectoryXYZ)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Adds%20trajectory%20in%20time%2C%20with%20time%20shown%20with%20viridis%20colouring.%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%20%3D%20pv.Spline(trajectoryXYZ%20*%20self.r%2C%201000)%0A%20%20%20%20%20%20%20%20%20%20%20%20spline%5B%22scalars%22%5D%20%3D%20np.arange(spline.n_points)%0A%20%20%20%20%20%20%20%20%20%20%20%20tubes%3Dspline.tube(radius%3D0.02)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.add_mesh(tubes%2C%20smooth_shading%3DTrue%2C%20color%20%3D%20cDUk%2C%20show_scalar_bar%3DFalse)%0A%0A%20%20%20%20%20%20%20%20def%20plot(self%2C%20axis%3DNone%2C%20debug%3DFalse%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cameraPosition%3D%5B(12.2%2C%204.0%2C%204.0)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(0.0%2C%200.0%2C%200.0)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(0.0%2C%200.0%2C%201)%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20labelAxis%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20labelSize%3D12%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dpi%3D100%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%5Br%22%24%7Ce%5Crangle%24%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r%22%24%7Cg%5Crangle%24%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r%22%24%5Cfrac%7B%7Ce%5Crangle%2B%7Cg%5Crangle%7D%7B%5Csqrt%7B2%7D%7D%24%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r%22%24%5Cfrac%7B%7Ce%5Crangle%2Bi%7Cg%5Crangle%7D%7B%5Csqrt%7B2%7D%7D%24%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20labelOffset%3DNone%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.enable_depth_peeling(10)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.p.camera_position%20%3D%20cameraPosition%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%5B(13.0%2C%200.0%2C%201.0)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%20(0.0%2C%200.0%2C%200.0)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%20(0.1%2C%200.0%2C%200.1)%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20axis%3D%3DNone%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20labelAxis%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20print(%22Note%3A%20Bloch%20sphere%20axis%20are%20labeled%20only%20if%20axis%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20argument%20is%20passed%20to%20plot%20function%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.p.show()%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20png_output%20%3D%20BytesIO()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20self.p.show(screenshot%3Dpng_output)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20labelAxis%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20generator%20%3D%20latex2png()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20im%20%3D%20Image.fromarray(self.p.image)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20im%20%3D%20im.convert(%22RGBA%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20labelOffset%20%3D%3D%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20labelOffset%20%3D%20%5B(int(im.size%5B0%5D*0.53)%2C%2010)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(int(im.size%5B0%5D*0.53)%2C%20int(im.size%5B1%5D*0.87))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(int(im.size%5B0%5D*0.35)%2C%20int(im.size%5B1%5D*0.6))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(int(im.size%5B0%5D*0.86)%2C%20int(im.size%5B1%5D*0.54))%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20i%20in%20range(len(labelOffset))%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20labelLatex%20%3D%20generator.make_png(label%5Bi%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fontsize%3DlabelSize%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20dpi%3Ddpi%20*%20self.resolution*2)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23white_to_transparency(Image.open(labelLatex))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20l%20%3D%20Image.open(labelLatex)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20im.paste(l%2C%20labelOffset%5Bi%5D%2C%20l.convert('RGBA'))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20axis.imshow(im)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20axis.imshow(self.p.image)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20not%20debug%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20axis.set_axis_off()%0A%20%20%20%20return%20(BlochSphere%2C)%0A%0A%0A%40app.cell%0Adef%20_(colorsys%2C%20mcolors%2C%20np)%3A%0A%20%20%20%20%23%3A%20Durham%20colour%20scheme%0A%20%20%20%20cDUp%20%3D%20%22%237E317B%22%20%20%23%20Palatinate%20Purple%0A%20%20%20%20cDUpp%20%3D%20%20%22%23D8ACF4%22%20%20%23%20Light%20purple%0A%20%20%20%20cDUb%20%3D%20%22%23006388%22%20%20%23%20Blue%0A%20%20%20%20cDUbb%20%3D%20%22%2391B8BD%22%20%20%23%20Mid%20Blue%0A%20%20%20%20cDUbbb%20%3D%20%22%23C4E5FA%22%20%20%23%20Light%20Blue%0A%20%20%20%20cDUbbbb%20%3D%20%22%2300AEEF%22%0A%20%20%20%20cDUsky%20%3D%20%22%23A5C8D0%22%20%20%23%20sky%20blue%0A%20%20%20%20cDUo%20%3D%20%22%239FA161%22%20%20%23%20Olive%20Green%0A%20%20%20%20cDUr%20%3D%20%22%23AA2B4A%22%20%20%23%20Red%0A%20%20%20%20cDUrr%20%3D%20%22%23BE1E2D%22%0A%20%20%20%20cDUy%20%3D%20%22%23E8E391%22%20%23%20%20Yellow%0A%20%20%20%20cDUp%20%3D%20%22%23C43B8E%22%20%23%20Pink%0A%20%20%20%20cDUk%20%3D%20%22%23231F20%22%20%20%23%20Black%0A%20%20%20%20cDUkk%20%3D%20%22%23002A41%22%20%23%20ink%0A%20%20%20%20cDUggg%20%3D%20%22%23CFDAD1%22%20%20%23%20Near%20White%2FL.%20Grey%0A%20%20%20%20cDUgg%20%3D%20%22%23968E85%22%20%20%23%20Warm%20Grey%0A%20%20%20%20cDUg%20%3D%20%22%236E6464%22%20%20%23%20midgrey%0A%0A%20%20%20%20def%20make_colormap(seq)%3A%0A%20%20%20%20%20%20%20%20seq%20%3D%20%5B(None%2C%20)%20*%203%2C%200.0%5D%20%2B%20list(seq)%20%2B%20%5B1.0%2C%20(None%2C%20)%20*%203%5D%0A%20%20%20%20%20%20%20%20cdict%20%3D%20%7B'red'%3A%20%5B%5D%2C%20'green'%3A%20%5B%5D%2C%20'blue'%3A%20%5B%5D%7D%0A%20%20%20%20%20%20%20%20for%20i%2C%20item%20in%20enumerate(seq)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20isinstance(item%2C%20float)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r1%2C%20g1%2C%20b1%20%3D%20seq%5Bi%20-%201%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r2%2C%20g2%2C%20b2%20%3D%20seq%5Bi%20%2B%201%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cdict%5B'red'%5D.append(%5Bitem%2C%20r1%2C%20r2%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cdict%5B'green'%5D.append(%5Bitem%2C%20g1%2C%20g2%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cdict%5B'blue'%5D.append(%5Bitem%2C%20b1%2C%20b2%5D)%0A%20%20%20%20%20%20%20%20return%20mcolors.LinearSegmentedColormap('CustomMap'%2C%20cdict)%0A%0A%20%20%20%20c%20%3D%20mcolors.ColorConverter().to_rgb%0A%20%20%20%20rvb%20%3D%20make_colormap(%5B%0A%20%20%20%20%20%20%20%20c('%23b20000')%2C%0A%20%20%20%20%20%20%20%20c('%23fe7600')%2C%200.125%2C%0A%20%20%20%20%20%20%20%20c('%23fe7600')%2C%0A%20%20%20%20%20%20%20%20c('%23feca00')%2C%200.25%2C%0A%20%20%20%20%20%20%20%20c('%23feca00')%2C%0A%20%20%20%20%20%20%20%20c('%23bcfd00')%2C%200.375%2C%0A%20%20%20%20%20%20%20%20c('%23bcfd00')%2C%0A%20%20%20%20%20%20%20%20c('%2306a133')%2C%200.5%2C%0A%20%20%20%20%20%20%20%20c('%2306a133')%2C%0A%20%20%20%20%20%20%20%20c('%2300f6fd')%2C%200.625%2C%0A%20%20%20%20%20%20%20%20c('%2300f6fd')%2C%0A%20%20%20%20%20%20%20%20c('%23000cfe')%2C%200.75%2C%0A%20%20%20%20%20%20%20%20c('%23000cfe')%2C%0A%20%20%20%20%20%20%20%20c('%23e404fe')%2C%200.875%2C%0A%20%20%20%20%20%20%20%20c('%23e404fe')%2C%0A%20%20%20%20%20%20%20%20c('%23b20000')%0A%20%20%20%20%5D)%0A%0A%20%20%20%20def%20getColor(amplitude%2C%20phase%2C%20maxAmplitude)%3A%0A%20%20%20%20%20%20%20%20c%20%3D%20rvb(phase%20%2F%20(2.%20*%20np.pi))%0A%20%20%20%20%20%20%20%20scale%20%3D%20amplitude%20%2F%20maxAmplitude%0A%20%20%20%20%20%20%20%20if%20scale%20%3E%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Error')%0A%20%20%20%20%20%20%20%20cc%20%3D%20colorsys.rgb_to_hls(c%5B0%5D%2C%20c%5B1%5D%2C%20c%5B2%5D)%0A%20%20%20%20%20%20%20%20c%20%3D%20colorsys.hls_to_rgb(cc%5B0%5D%2C%20cc%5B1%5D%20%2B%20(1.%20-%20scale)%20*%20(1.%20-%20cc%5B1%5D)%2C%20cc%5B2%5D)%0A%20%20%20%20%20%20%20%20return%20(c%5B0%5D%2C%20c%5B1%5D%2C%20c%5B2%5D%2C%201.0)%0A%0A%20%20%20%20def%20getComplexColor(complexNo%2C%20maxAmplitude)%3A%0A%20%20%20%20%20%20%20%20angle%20%3D%20np.angle(complexNo)%0A%20%20%20%20%20%20%20%20if%20angle%20%3C%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20angle%20%2B%3D%202%20*%20np.pi%0A%20%20%20%20%20%20%20%20return%20getColor(np.absolute(complexNo)%2C%20angle%2C%20maxAmplitude)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20c%2C%0A%20%20%20%20%20%20%20%20cDUb%2C%0A%20%20%20%20%20%20%20%20cDUbb%2C%0A%20%20%20%20%20%20%20%20cDUbbb%2C%0A%20%20%20%20%20%20%20%20cDUbbbb%2C%0A%20%20%20%20%20%20%20%20cDUg%2C%0A%20%20%20%20%20%20%20%20cDUgg%2C%0A%20%20%20%20%20%20%20%20cDUggg%2C%0A%20%20%20%20%20%20%20%20cDUk%2C%0A%20%20%20%20%20%20%20%20cDUkk%2C%0A%20%20%20%20%20%20%20%20cDUo%2C%0A%20%20%20%20%20%20%20%20cDUp%2C%0A%20%20%20%20%20%20%20%20cDUpp%2C%0A%20%20%20%20%20%20%20%20cDUr%2C%0A%20%20%20%20%20%20%20%20cDUrr%2C%0A%20%20%20%20%20%20%20%20cDUsky%2C%0A%20%20%20%20%20%20%20%20cDUy%2C%0A%20%20%20%20%20%20%20%20getColor%2C%0A%20%20%20%20%20%20%20%20getComplexColor%2C%0A%20%20%20%20%20%20%20%20make_colormap%2C%0A%20%20%20%20%20%20%20%20rvb%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20matplotlib.pyplot%20as%20plt%0A%20%20%20%20import%20pyvista%20as%20pv%0A%20%20%20%20from%20io%20import%20BytesIO%0A%20%20%20%20from%20scipy.linalg%20import%20kron%2C%20eig%0A%20%20%20%20from%20math%20import%20isclose%0A%20%20%20%20import%20matplotlib.colors%20as%20mcolors%0A%20%20%20%20import%20colorsys%0A%20%20%20%20return%20BytesIO%2C%20colorsys%2C%20eig%2C%20isclose%2C%20kron%2C%20mcolors%2C%20mo%2C%20np%2C%20plt%2C%20pv%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
